<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter docker.**>
  @type grep
  # Positive match: Only keep lines that likely contain a high-severity indicator
  <regexp>
    key log
    pattern /(warning|error|fatal|critical|severe|panic)/i
  </regexp>
  # Negative match: Specifically exclude lines that are marked as INFO, DEBUG, or TRACE
  <exclude>
    key log
    pattern /"level":\s*"(INFO|DEBUG|TRACE)"/i
  </exclude>
</filter>

<match docker.**>
  @type file
  path /fluentd/log/${tag}
  add_path_suffix true
  path_suffix .log
  append true
  <format>
    @type json
  </format>
  <buffer tag>
    @type file
    path /tmp/fluentd/buffer
    flush_mode interval
    flush_interval 5s
    chunk_limit_size 1MB
  </buffer>
  # Log rotation: Keep 5 historical files of 10MB each
  # If these parameters continue to fail, we will consider alternate rotation methods
</match>
